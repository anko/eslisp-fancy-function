(= run-test (function (name func)
 ((require "tape") name (function (t)
                                  (func t)
                                  (t.end))))) ; Automatically end tests

(= eslc
 (function (code)
           (= full-code ; wrap in a call
              (+ "(macro fun (require \"./index.js\"))"
                 code))
           (return ((require "eslisp") full-code))))

(macro test
 (function (name body)
  (return `(run-test ,name (function (t) ,@body)))))

; - - -

(test "normal"
      ((t.equals
        (eslc "(fun (x y) (x y))")
        "(function (x, y) {\n    x(y);\n});")))

(test "normal and splat argument"
      ((t.equals
        (eslc "(fun (x ...y) (x y))")
        "(function (x) {\n    var y = Array.prototype.slice.call(arguments, 1, 2);\n    x(y);\n});")))

(test "normal and splat argument and normals again"
      ((t.equals
        (eslc "(fun (x ...y z1 z2) (x y z1 z2))")
        "(function (x) {\n    var y = Array.prototype.slice.call(arguments, 1, 2);\n    var z1 = arguments[2];\n    var z2 = arguments[3];\n    x(y, z1, z2);\n});")))

(test "splat argument"
      ((t.equals
        (eslc "(fun (...x) (x))")
        "(function () {\n    var x = Array.prototype.slice.call(x);\n    x();\n})")))
